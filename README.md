# C++ SBE Sample Application

This sample application is designed to decode responses from the `api/v3/exchangeInfo` and `api/v3/account` endpoints, when using [Binance Spot API Simple Binary Encoding (SBE)](https://github.com/binance/binance-spot-api-docs/blob/master/faqs/sbe_faq.md). It decodes a payload from STDIN and prints it as JSON to STDOUT.

This sample application is currently supported on Linux and macOS. 

## Getting Started

1. Clone the source code:
```shell
$ git clone git@github.com:binance/binance-sbe-cpp-sample-app.git
```

2. Navigate to the directory where the `main.cpp` file is located and use the following command to generate `sbe-sample-app`:
```shell
$ c++ -std=c++17 -Wextra -Wall -o sbe-sample-app ./main.cpp
```

## Usage

### Pipe ExchangeInfo SBE response into sbe-sample-app

The following command fetches the `exchangeInfo` SBE response and has `sbe-sample-app` decode it and output it as JSON to STDOUT:

```shell
$ curl -X GET -H 'Accept: application/sbe' -H 'X-MBX-SBE: 1:0' \
    'https://api.binance.com/api/v3/exchangeInfo' \
    | ./sbe-sample-app
```

### Pipe Account SBE response into sbe-sample-app

The following commands fetch the `account` SBE response and have `sbe-sample-app` decode it and output it as JSON to STDOUT:

#### HMAC SHA256 keys

```shell
$ timestamp=$(date +%s000); \
    signature=$(echo -n "timestamp=$timestamp" | openssl dgst -sha256 -hmac "<your_secret_key>"); \
    signature=${signature#*= }; \
    curl -X GET -H 'X-MBX-APIKEY: <your_api_key>' -H 'Accept: application/sbe' -H 'X-MBX-SBE: 1:0' \
    'https://api.binance.com/api/v3/account?timestamp='$timestamp'&signature='$signature'' \
    | ./sbe-sample-app
```

#### RSA keys

```shell
$ timestamp=$(date +%s000); \
    signature=$(echo -n "timestamp=$timestamp" | openssl dgst -sha256 -sign "<pem file path>" | openssl enc -base64 -A); \
    signature=${signature#*= }; \
    curl -X GET -H 'X-MBX-APIKEY: <your_api_key>' -H 'Accept: application/sbe' -H 'X-MBX-SBE: 1:0' \
    'https://api.binance.com/api/v3/account?timestamp='$timestamp'&signature='$signature'' \
    | ./sbe-sample-app
```

#### ED25519 keys

```shell
$ timestamp=$(date +%s000); \
    echo -n "timestamp=$timestamp" > to_be_signed.txt; \
    signature=$(openssl pkeyutl -sign -inkey "<pem file path>" -rawin -in to_be_signed.txt | openssl enc -base64 -A); \
    signature=${signature#*= }; \
    curl -X GET -H 'X-MBX-APIKEY: <your_api_key>' -H 'Accept: application/sbe' -H 'X-MBX-SBE: 1:0' \
    'https:api.binance.com/api/v3/account?timestamp='$timestamp'&signature='$signature'' \
    | ./sbe-sample-app
```

**notes:**
- The code in the `main.cpp` file, along with the accompanying header files, is designed specifically for decoding the responses from the `api/v3/exchangeInfo` and `api/v3/account` endpoints. 
- There are additional decoder classes in the `spot_sbe` folder that can be useful for decoding SBE responses from other endpoints in the Binance Spot API.

### Testnet 

To use the Spot Testnet API, change the domain name in the URL portion of the command from `https://api.binance.com` to `https://testnet.binance.vision`.

### Code formatting

The C++ code in this repository was formatted by running:
```shell
$ clang-format-15 -i --style '{BasedOnStyle: chromium, IndentWidth: 4, ColumnLimit: 100}' *.h *.cpp
```

## Updates

### C++ decoders

The `spot_sbe` directory contains code generated by [simple-binary-encoding](https://github.com/real-logic/simple-binary-encoding), which you will likely want to reuse verbatim. However, if you would like to update it, please navigate to the root of this project and follow these steps:

1) Download the schema file ([spot_latest.xml](https://github.com/binance/binance-spot-api-docs/tree/master/sbe/schemas/spot_latest.xml)):
```shell
$ curl -o spot_latest.xml https://raw.githubusercontent.com/binance/binance-spot-api-docs/master/sbe/schemas/$(curl -s https://raw.githubusercontent.com/binance/binance-spot-api-docs/master/sbe/schemas/spot_latest.xml)
```

2) Clone & build [simple-binary-encoding](https://github.com/real-logic/simple-binary-encoding):
```shell
$ git clone https://github.com/real-logic/simple-binary-encoding.git --branch 1.30.0
$ cd simple-binary-encoding
$ ./gradlew
$ cd ..
```

3) Run the SBE tool code generator built in the previous step:
```shell
$ java \
    -Dsbe.output.dir=. \
    -Dsbe.target.language=Cpp \
    -jar simple-binary-encoding/sbe-all/build/libs/sbe-all-1.30.0.jar \
    spot_latest.xml
```
